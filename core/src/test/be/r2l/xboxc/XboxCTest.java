package test.be.r2l.xboxc;

import static org.mockito.Mockito.doNothing;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.verify;

import org.junit.Before;
import org.junit.Test;

import be.r2l.xboxc.XboxC;
import be.r2l.xboxc.XboxControllerHelper;
import be.r2l.xboxc.XboxControllerObservable;
import be.r2l.xboxc.view.MainView;

public class XboxCTest {

	private static final float DELTA_TIME = .666f;
	private static final String IP_ADDRESS = "127.0.0.1";
	private static final int PORT = 8099;

	private MainView mockMainView;
	private XboxControllerObservable mockObservable;
	private XboxControllerHelper mockHelper;
	private XboxC xboxCToTest;

	@Before
	public void setup() {
		mockMainView = mock(MainView.class);
		doNothing().when(mockMainView).render(DELTA_TIME);
		mockObservable = mock(XboxControllerObservable.class);
		mockHelper = mock(XboxControllerHelper.class);
		doNothing().when(mockHelper).addListenerToEveryController();
		xboxCToTest = new TestXboxC(IP_ADDRESS, PORT);
	}

	@Test
	public void createShouldAddListenersToControllers() {
		xboxCToTest.create();
		verify(mockHelper, times(1)).addListenerToEveryController();
	}

	@Test
	public void renderShouldRenderMainView() {
		xboxCToTest.create();
		xboxCToTest.render();
		verify(mockMainView, times(1)).render(DELTA_TIME);
	}

	@Test
	public void disposeShouldDisposeMainView() {
		xboxCToTest.create();
		xboxCToTest.dispose();
		verify(mockMainView, times(1)).dispose();
	}

	private class TestXboxC extends XboxC {
		public TestXboxC(String ip_address, int port) {
			super(ip_address, port);
			// TODO Auto-generated constructor stub
		}

		@Override
		protected MainView getMainView() {
			return mockMainView;
		}

		@Override
		protected XboxControllerHelper getXboxControllerHelper() {
			return mockHelper;
		}

		@Override
		protected XboxControllerObservable getXboxControllerObservable() {
			return mockObservable;
		}

		@Override
		protected float getDeltaTime() {
			return DELTA_TIME;
		}
	}
}
